{"version":3,"sources":["App.js","index.js"],"names":["Login","React","lazy","Main","createBrowserHistory","App","webSocket","ProvideAuth","fallback","LinearBuffer","path","PublicPage","PrivateRoute","Component","from","to","classes","makeStyles","root","position","height","width","display","justifyContent","backgroundColor","alignItems","useStyles","className","fakeAuth","isAuthenticated","signin","cb","setTimeout","signout","authContext","createContext","children","auth","useState","user","setUser","useProvideAuth","Provider","value","useAuth","useContext","rest","isLoading","setIsLoading","console","log","history","useHistory","location","useLocation","useEffect","send","JSON","stringify","type","onmessage","e","data","parse","content","is_auth","handleLogin","localStorage","getItem","username","password","push","status","clear","state","pathname","replace","WebSocket","window","hostname","Init","connectWebSocket","setConnectWebSocket","onopen","onclose","disableShrink","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.74fa1f2e.chunk.js","sourcesContent":["import React, { useState , useEffect, Suspense,  useContext, createContext} from \"react\";\r\nimport { createBrowserHistory } from \"history\";\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route,\r\n  Link,\r\n  Redirect,\r\n  useHistory,\r\n  useLocation\r\n} from \"react-router-dom\";\r\n\r\n// pages for this product\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\nimport \"assets/css/material-dashboard-react.css?v=1.9.0\";\r\nimport { useCallback } from \"react\";\r\n\r\n// core components\r\nconst Login = React.lazy(() => import(\"layouts/Login\"));\r\nconst Main = React.lazy(() => import(\"layouts/Main.js\"));\r\n\r\n\r\nconst hist = createBrowserHistory();\r\n\r\nexport default function App({webSocket}) {\r\n    return (\r\n    <div>\r\n        <ProvideAuth>\r\n            <Router>\r\n                <Suspense fallback={<LinearBuffer/>}>\r\n                  <div>\r\n                    <Switch>\r\n                        <Route path=\"/public\">\r\n                            <PublicPage />\r\n                        </Route>\r\n                        <Route path=\"/login\">\r\n                          <Login webSocket={webSocket}/>\r\n                        </Route>\r\n                        <PrivateRoute path=\"/lax_medic\" webSocket={webSocket} Component={Main}/>\r\n                        <Redirect from='/'  to='lax_medic' />\r\n                    </Switch>\r\n                  </div>\r\n                </Suspense>\r\n              </Router>\r\n            </ProvideAuth>\r\n          </div>\r\n        )\r\n}\r\n\r\nfunction LinearBuffer() {\r\n    const useStyles = makeStyles({\r\n    root: {\r\n      position: 'fixed',\r\n      height: '100vh',\r\n      width: '100vw',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      backgroundColor: 'white',\r\n      alignItems: 'center',\r\n    },\r\n  });\r\n    const classes = useStyles();\r\n    return (\r\n      <div className={classes.root}>\r\n        <CircularProgress/>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const fakeAuth = {\r\n    isAuthenticated: false,\r\n    signin(cb) {\r\n      fakeAuth.isAuthenticated = true;\r\n      setTimeout(cb, 100); // fake async\r\n    },\r\n    signout(cb) {\r\n      fakeAuth.isAuthenticated = false;\r\n      setTimeout(cb, 100);\r\n    }\r\n  };\r\n  \r\nconst authContext = createContext();\r\n \r\nfunction useProvideAuth() {\r\n  const [user, setUser] = useState(null);\r\n\r\n  const signin = cb => {\r\n    return fakeAuth.signin(() => {\r\n      setUser(cb());\r\n    });\r\n  };\r\n\r\n  const signout = cb => {\r\n    return fakeAuth.signout(() => {\r\n      setUser(null);\r\n      cb();\r\n    });\r\n  };\r\n\r\n  return {\r\n    user,\r\n    signin,\r\n    signout\r\n  };\r\n}\r\n\r\n  function ProvideAuth({ children }) {\r\n    const auth = useProvideAuth();\r\n    return (\r\n      <authContext.Provider value={auth}>\r\n        {children}\r\n      </authContext.Provider>\r\n    );\r\n  }\r\n  \r\nexport  function useAuth() {\r\n    return useContext(authContext);\r\n  }\r\n  \r\n  // A wrapper for <Route> that redirects to the login\r\n  // screen if you're not yet authenticated.\r\n  function PrivateRoute({ webSocket, Component, ...rest }) {\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    console.log('private')\r\n    let history = useHistory();\r\n    let location = useLocation();\r\n    let auth = useAuth();\r\n\r\n    useEffect(() => {\r\n      if(auth.user){\r\n        setIsLoading(null)\r\n      }else{\r\n\r\n        setTimeout(() => {\r\n            webSocket.send(JSON.stringify({\r\n            type: 'init'\r\n            }))\r\n        }, 1000);\r\n\r\n        webSocket.onmessage = (e)=>{\r\n          const data = JSON.parse(e.data);\r\n          console.log(data)\r\n\r\n          if(data.type === \"init\"){\r\n            console.log(data.content)\r\n\r\n            if(data.content.is_auth){\r\n              console.log('welcome')\r\n              handleLogin(data.content.user)\r\n            }\r\n            else if(localStorage.getItem('azerty') && localStorage.getItem('querty')){\r\n              console.log(\"tu etais sauvegarder en local\")\r\n              webSocket.send(JSON.stringify({\r\n                type: 'login',\r\n                content:{\r\n                  username: localStorage.getItem('azerty'),\r\n                  password: localStorage.getItem('querty')\r\n                }\r\n              }))\r\n            }\r\n            else{\r\n              console.log(\"vous are not connect\")\r\n              history.push('/login')\r\n            }\r\n\r\n          }\r\n          if(data.type === \"login\"){\r\n            console.log(data.content)\r\n      \r\n            if(data.status===\"success\"){\r\n              console.log('welcome')\r\n              handleLogin(data.content.user)\r\n            }\r\n            else{\r\n              console.log(\"vous are not connect\")\r\n              localStorage.clear('azerty')\r\n              localStorage.clear('querty')\r\n              history.push('/login')\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }, [])\r\n\r\n    let { from } = location.state || { from: { pathname: \"/\" } };\r\n    const handleLogin = (user) => {\r\n      auth.signin(() => {\r\n        history.replace(from);\r\n        return user\r\n      });\r\n    };\r\n\r\n    return (\r\n      <Route\r\n        {...rest}>\r\n          {isLoading \r\n            ? (\r\n              <div>\r\n                <LinearBuffer/>\r\n              </div>\r\n            )\r\n            : auth.user \r\n              ? (<Component webSocket={webSocket}/>) \r\n              : ( <Redirect\r\n                    to={{\r\n                      pathname: \"/login\",\r\n                      state: { from: location }\r\n                    }}\r\n                  />\r\n                )\r\n          }\r\n          </Route>\r\n    );\r\n  }\r\n  \r\n  function PublicPage() {\r\n    return <h3>Public</h3>;\r\n  }\r\n  \r\n  function LoginPage() {\r\n    let history = useHistory();\r\n    let location = useLocation();\r\n    let auth = useAuth();\r\n  \r\n    let { from } = location.state || { from: { pathname: \"/\" } };\r\n    let login = () => {\r\n      auth.signin(() => {\r\n        history.replace(from);\r\n        return 'user'\r\n      });\r\n    };\r\n  \r\n    return (\r\n      <div>\r\n        <p>You must log in to view the page at {from.pathname}</p>\r\n        <button onClick={login}>Log in</button>\r\n      </div>\r\n    );\r\n  } ","/*!\n\n=========================================================\n* Akelax Technologie React - v1.9.0\n=========================================================\n\n* Product Page: https://www.creative-tim.com/product/material-dashboard-react\n* Copyright 2020 Creative Tim (https://www.creative-tim.com)\n* Licensed under MIT (https://github.com/creativetimofficial/material-dashboard-react/blob/master/LICENSE.md)\n\n* Coded by Creative Tim\n\n=========================================================\n\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n*/\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\n// core components\nimport App from \"./App.js\";\n\nimport \"assets/css/material-dashboard-react.css?v=1.9.0\";\n\nconst webSocket = new WebSocket(\n  'ws://' +\n  window.location.hostname +\n  ':8000' +\n  '/ws/lax_medic/' +\n  'personal/'\n);\n\nconst Init = () =>{\n  const [connectWebSocket, setConnectWebSocket] = React.useState(null)\n  React.useEffect(() => {\n    webSocket.onopen  = () => setConnectWebSocket(webSocket);\n    webSocket.onclose = () => setConnectWebSocket(null);\n  }, [])\n\n  return (\n    <>\n    {connectWebSocket\n      ? <App webSocket={connectWebSocket}/>\n      : <LinearBuffer/>\n    }\n    </>\n  )\n}\n\nfunction LinearBuffer() {\n  const useStyles = makeStyles({\n  root: {\n    position: 'fixed',\n    height: '100vh',\n    width: '100vw',\n    display: 'flex',\n    justifyContent: 'center',\n    backgroundColor: 'white',\n    alignItems: 'center',\n  },\n});\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n      <CircularProgress disableShrink/>\n    </div>\n  );\n}\n\nReactDOM.render(\n  <Init/>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}