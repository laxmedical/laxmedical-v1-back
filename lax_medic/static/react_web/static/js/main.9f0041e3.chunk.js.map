{"version":3,"sources":["App.js","index.js"],"names":["Login","React","lazy","Main","createBrowserHistory","App","webSocket","useState","JSON","parse","localStorage","getItem","darkMode","theme","useMemo","createMuiTheme","palette","type","primary","blue","secondary","pink","useEffect","setItem","stringify","ProvideAuth","fallback","LinearBuffer","path","PublicPage","PrivateRoute","Component","from","to","classes","makeStyles","root","position","height","width","display","justifyContent","backgroundColor","alignItems","useStyles","className","fakeAuth","isAuthenticated","signin","cb","setTimeout","signout","authContext","createContext","children","auth","user","setUser","useProvideAuth","Provider","value","useAuth","useContext","rest","isLoading","setIsLoading","console","log","history","useHistory","location","useLocation","send","onmessage","e","data","content","is_auth","handleLogin","username","password","push","status","clear","state","pathname","replace","WebSocket","window","hostname","Init","connectWebSocket","setConnectWebSocket","wsState","setWsState","onopen","onclose","Disconnect","disableShrink","flexDirection","style","fontSize","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.9f0041e3.chunk.js","sourcesContent":["import React, { useState , useEffect, Suspense,  useContext, createContext} from \"react\";\r\nimport { createBrowserHistory } from \"history\";\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route,\r\n  Redirect,\r\n  useHistory,\r\n  useLocation\r\n} from \"react-router-dom\";\r\n\r\n// pages for this product\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport {pink, blue} from '@material-ui/core/colors';\r\n\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\n\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\nimport \"assets/css/material-dashboard-react.css?v=1.9.0\";\r\n\r\n// core components\r\nconst Login = React.lazy(() => import(\"layouts/Login\"));\r\nconst Main = React.lazy(() => import(\"layouts/Main.js\"));\r\n\r\n\r\nconst hist = createBrowserHistory();\r\n\r\nexport default function App({webSocket}) {  \r\n  const [darkMode, setDarkMode] = React.useState(JSON.parse(localStorage.getItem('darkMode')) || false )\r\n\r\n  const theme = React.useMemo(\r\n    () =>\r\n      createMuiTheme({\r\n        palette: {\r\n          type: darkMode ? 'dark' : 'light',\r\n          primary:  blue,\r\n          secondary: pink,\r\n        },\r\n      }),\r\n    [darkMode],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    localStorage.setItem('darkMode',JSON.stringify(darkMode));\r\n  }, [darkMode])\r\n\r\n    return (\r\n    <div>\r\n        <ProvideAuth>\r\n      <ThemeProvider theme={theme}>\r\n      <CssBaseline/>\r\n            <Router>\r\n                <Suspense fallback={<LinearBuffer/>}>\r\n                  <div>\r\n                    <Switch>\r\n                        <Route path=\"/public\">\r\n                            <PublicPage />\r\n                        </Route>\r\n                        <Route path=\"/login\">\r\n                          <Login webSocket={webSocket}/>\r\n                        </Route>\r\n                        <PrivateRoute path=\"/lax_medic\" webSocket={webSocket} Component={Main}/>\r\n                        <Redirect from='/'  to='lax_medic' />\r\n                    </Switch>\r\n                  </div>\r\n                </Suspense>\r\n              </Router>\r\n       </ThemeProvider>\r\n    </ProvideAuth>\r\n          </div>\r\n        )\r\n}\r\n\r\nfunction LinearBuffer() {\r\n    const useStyles = makeStyles({\r\n    root: {\r\n      position: 'fixed',\r\n      height: '100vh',\r\n      width: '100vw',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      backgroundColor: 'white',\r\n      alignItems: 'center',\r\n    },\r\n  });\r\n    const classes = useStyles();\r\n    return (\r\n      <div className={classes.root}>\r\n        <CircularProgress/>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const fakeAuth = {\r\n    isAuthenticated: false,\r\n    signin(cb) {\r\n      fakeAuth.isAuthenticated = true;\r\n      setTimeout(cb, 100); // fake async\r\n    },\r\n    signout(cb) {\r\n      fakeAuth.isAuthenticated = false;\r\n      setTimeout(cb, 100);\r\n    }\r\n  };\r\n  \r\nconst authContext = createContext();\r\n \r\nfunction useProvideAuth() {\r\n  const [user, setUser] = useState(null);\r\n\r\n  const signin = cb => {\r\n    return fakeAuth.signin(() => {\r\n      setUser(cb());\r\n    });\r\n  };\r\n\r\n  const signout = cb => {\r\n    return fakeAuth.signout(() => {\r\n      setUser(null);\r\n      cb();\r\n    });\r\n  };\r\n\r\n  return {\r\n    user,\r\n    signin,\r\n    signout\r\n  };\r\n}\r\n\r\n  function ProvideAuth({ children }) {\r\n    const auth = useProvideAuth();\r\n    return (\r\n      <authContext.Provider value={auth}>\r\n        {children}\r\n      </authContext.Provider>\r\n    );\r\n  }\r\n  \r\nexport  function useAuth() {\r\n    return useContext(authContext);\r\n  }\r\n  \r\n  // A wrapper for <Route> that redirects to the login\r\n  // screen if you're not yet authenticated.\r\n  function PrivateRoute({ webSocket, Component, ...rest }) {\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    console.log('private')\r\n    let history = useHistory();\r\n    let location = useLocation();\r\n    let auth = useAuth();\r\n\r\n    useEffect(() => {\r\n      if(auth.user){\r\n        setIsLoading(null)\r\n      }else{\r\n\r\n        setTimeout(() => {\r\n            webSocket.send(JSON.stringify({\r\n            type: 'init'\r\n            }))\r\n        }, 500);\r\n\r\n        webSocket.onmessage = (e)=>{\r\n          const data = JSON.parse(e.data);\r\n          console.log(data)\r\n\r\n          if(data.type === \"init\"){\r\n            console.log(data.content)\r\n\r\n            if(data.content.is_auth){\r\n              console.log('welcome')\r\n              handleLogin(data.content.user)\r\n            }\r\n            else if(localStorage.getItem('azerty') && localStorage.getItem('querty')){\r\n              console.log(\"tu etais sauvegarder en local\")\r\n              webSocket.send(JSON.stringify({\r\n                type: 'login',\r\n                content:{\r\n                  username: localStorage.getItem('azerty'),\r\n                  password: localStorage.getItem('querty')\r\n                }\r\n              }))\r\n            }\r\n            else{\r\n              console.log(\"vous are not connect\")\r\n              history.push('/login')\r\n            }\r\n\r\n          }\r\n          if(data.type === \"login\"){\r\n            console.log(data.content)\r\n      \r\n            if(data.status===\"success\"){\r\n              console.log('welcome')\r\n              handleLogin(data.content.user)\r\n            }\r\n            else{\r\n              console.log(\"vous are not connect\")\r\n              localStorage.clear('azerty')\r\n              localStorage.clear('querty')\r\n              history.push('/login')\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }, [])\r\n\r\n    let { from } = location.state || { from: { pathname: \"/\" } };\r\n    const handleLogin = (user) => {\r\n      auth.signin(() => {\r\n        history.replace(from);\r\n        return user\r\n      });\r\n    };\r\n\r\n    return (\r\n      <Route\r\n        {...rest}>\r\n          {isLoading \r\n            ? (\r\n              <div>\r\n                <LinearBuffer/>\r\n              </div>\r\n            )\r\n            : auth.user \r\n              ? (<Component webSocket={webSocket}/>) \r\n              : ( <Redirect\r\n                    to={{\r\n                      pathname: \"/login\",\r\n                      state: { from: location }\r\n                    }}\r\n                  />\r\n                )\r\n          }\r\n          </Route>\r\n    );\r\n  }\r\n  \r\n  function PublicPage() {\r\n    return <h3>Public</h3>;\r\n  }\r\n  \r\n  function LoginPage() {\r\n    let history = useHistory();\r\n    let location = useLocation();\r\n    let auth = useAuth();\r\n  \r\n    let { from } = location.state || { from: { pathname: \"/\" } };\r\n    let login = () => {\r\n      auth.signin(() => {\r\n        history.replace(from);\r\n        return 'user'\r\n      });\r\n    };\r\n  \r\n    return (\r\n      <div>\r\n        <p>You must log in to view the page at {from.pathname}</p>\r\n        <button onClick={login}>Log in</button>\r\n      </div>\r\n    );\r\n  } ","/*!\n\n=========================================================\n* Akelax Technologie React - v1.9.0\n=========================================================\n\n* Product Page: https://www.creative-tim.com/product/material-dashboard-react\n* Copyright 2020 Creative Tim (https://www.creative-tim.com)\n* Licensed under MIT (https://github.com/creativetimofficial/material-dashboard-react/blob/master/LICENSE.md)\n\n* Coded by Creative Tim\n\n=========================================================\n\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n*/\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport PortableWifiOffIcon from '@material-ui/icons/PortableWifiOff';\n\n// core components\nimport App from \"./App.js\";\n\nimport \"assets/css/material-dashboard-react.css?v=1.9.0\";\n\nconst webSocket = new WebSocket('ws://' +window.location.hostname +':8000' +'/ws/lax_medic/' +'personal/');\n\n\nconst Init = () =>{\n  const [connectWebSocket, setConnectWebSocket] = React.useState(null)\n  const [wsState, setWsState] = React.useState('')\n\n  React.useEffect(() => {\n    webSocket.onopen  = () => setConnectWebSocket(webSocket);\n    webSocket.onclose = () => {\n      setConnectWebSocket(null)\n      setWsState('disconnect')\n    };\n  }, [])\n\n  return (\n    <>\n    {connectWebSocket\n      ? <App webSocket={connectWebSocket}/>\n      : wsState === 'disconnect'\n        ? <Disconnect/>\n        : <LinearBuffer/>\n    }\n    </>\n  )\n}\n\nfunction LinearBuffer() {\n  const useStyles = makeStyles({\n  root: {\n    position: 'fixed',\n    height: '100vh',\n    width: '100vw',\n    display: 'flex',\n    justifyContent: 'center',\n    backgroundColor: 'white',\n    alignItems: 'center',\n  },\n});\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n      <CircularProgress disableShrink/>\n    </div>\n  );\n}\n\nfunction Disconnect() {\n  const useStyles = makeStyles({\n  root: {\n    position: 'fixed',\n    height: '100vh',\n    width: '100vw',\n    display: 'flex',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    backgroundColor: 'white',\n    alignItems: 'center',\n  },\n});\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n    <PortableWifiOffIcon style={{ fontSize: 150 }} />  \n    <p>Vous étes deconnecté du serveur</p>\n    </div>\n  );\n}\n\n\nReactDOM.render(\n  <Init/>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}